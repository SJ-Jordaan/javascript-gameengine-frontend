(()=>{"use strict";class t{constructor(t,e){this.x=t,this.y=e,this.distanceTo=this.distanceTo.bind(this)}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}}const e={character:"character",surface:"surface",background:"background"};Object.freeze(e);class i extends PIXI.Sprite{constructor(i,s){super(i),this.name=s.toLowerCase(),this.interactive=!0,this.buttonMode=!0,this.type=e.surface,this.anchor.set(.5),this.vertexPoints={topLeft:new t(this.x,this.y),topRight:new t(this.x+this.getBounds().width,this.y),bottomLeft:new t(this.x,this.y+this.getBounds().height),bottomRight:new t(this.x+this.getBounds().width,this.y+this.getBounds().height)},this.on("pointerdown",this.onDragStart).on("pointerup",this.onDragEnd).on("pointerupoutside",this.onDragEnd).on("pointermove",this.onDragMove),this.onDragStart=this.onDragStart.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDragMove=this.onDragMove.bind(this),this.updateVertexPoints=this.updateVertexPoints.bind(this),this.snapToEdge=this.snapToEdge.bind(this),this.snapToVertex=this.snapToVertex.bind(this),this.getSiblings=this.getSiblings.bind(this),this.transformEntity=this.transformEntity.bind(this)}updateVertexPoints(){this.vertexPoints={topLeft:new t(this.x,this.y),topRight:new t(this.x+this.getBounds().width,this.y),bottomLeft:new t(this.x,this.y+this.getBounds().height),bottomRight:new t(this.x+this.getBounds().width,this.y+this.getBounds().height)}}snapToEdge(t){"design"===this.parent.mode&&!0===this.parent.edgeSnap&&this.parent.children.filter((t=>t.x!==this.x&&t.y!==this.y)).forEach((i=>{i.type===e.surface&&(Math.abs(this.getBounds().top-i.getBounds().bottom)<t&&this.x<=i.getBounds().right&&this.x>=i.getBounds().left?(this.x=i.x,this.y=i.y+i.getBounds().height):Math.abs(this.getBounds().bottom-i.getBounds().top)<t&&this.x<=i.getBounds().right&&this.x>=i.getBounds().left?(this.x=i.x,this.y+=Math.abs(this.getBounds().bottom-i.getBounds().top)):Math.abs(this.getBounds().right-i.getBounds().left)<t&&this.y<=i.getBounds().bottom&&this.y>=i.getBounds().top?(this.y=i.y,this.x+=Math.abs(this.getBounds().right-i.getBounds().left)):Math.abs(this.getBounds().left-i.getBounds().right)<t&&this.y<=i.getBounds().bottom&&this.y>=i.getBounds().top&&(this.y=i.y,this.x=i.x+i.getBounds().width))}))}snapToVertex(t){"design"===this.parent.mode&&!0===this.parent.vertexSnap&&this.parent.children.filter((t=>t.x!==this.x&&t.y!==this.y)).forEach((i=>{i.type!==e.surface&&(this.vertexPoints.topLeft.distanceTo(i.vertexPoints.bottomRight)<=t?(this.x=i.x+i.getBounds().width,this.y=i.y+i.getBounds().height):this.vertexPoints.topRight.distanceTo(i.vertexPoints.bottomLeft)<=t?(this.x=i.x-this.getBounds().width,this.y=i.y+this.getBounds().height):this.vertexPoints.bottomRight.distanceTo(i.vertexPoints.topLeft)<=t?(this.x=i.x-this.getBounds().width,this.y=i.y-this.getBounds().height):this.vertexPoints.bottomLeft.distanceTo(i.vertexPoints.topRight)<=t&&(this.x=i.x+i.getBounds().width,this.y=i.y-this.getBounds().height))}))}setEntityType(t){this.type=e[t]}getSiblings(){return this.parent.children.filter((t=>t.name!==this.name))}transformX(t){this.x+=t,this.updateVertexPoints()}transformY(t){this.y+=t,this.updateVertexPoints()}transformEntity(t,e){this.transformX(t),this.transformY(e)}rotateEntity(t){this.setTransform(this.position.x,this.position.y,this.scale.x,this.scale.y,t),this.setTransform(this.position.x,this.position.y,this.scale.x,this.scale.y,t)}scaleEntity(t,e){this.setTransform(this.position.x,this.position.y,t,e,this.rotation)}onDragStart(t){this.parent.setSelectedEntityName(this.name),this.data=t.data,this.alpha=.5,this.dragging=!0,this.offX=this.x-this.data.getLocalPosition(this.parent).x,this.offY=this.y-this.data.getLocalPosition(this.parent).y}onDragEnd(){this.parent.setSelectedEntityName(this.name),this.alpha=1,this.dragging=!1,this.data=null}onDragMove(){if(this.dragging){const t=this.data.getLocalPosition(this.parent);this.x=t.x+this.offX,this.y=t.y+this.offY,this.updateVertexPoints(),this.snapToEdge(this.parent.snapDistance),this.snapToVertex(this.parent.snapDistance)}}}class s extends i{constructor(t,i,s=0,n=0){super(t,i),this.setTransform(s,n),this.anchor.set(.5),this.type=e.character,this.mass=0,this.acceleration=0,this.onSurface=this.onSurface.bind(this)}onSurface(){let t=!1;return this.type===e.surface&&(t=!0),this.getSiblings().forEach((i=>{i.type===e.surface&&function(t,e){const i=t.getBounds(),s=e.getBounds();return i.x<s.x+s.width&&i.x+i.width>s.x&&i.y<s.y+s.height&&i.y+i.height>s.y}(this,i)&&(t=!0)})),t}}class n extends PIXI.Container{constructor(t,e,i){super(),this.name=t,this.width=e,this.height=i,this.edgeSnap=!0,this.vertexSnap=!0,this.snapDistance=20,this.gravity=8,this.selectedEntityName,this.entitySelectedEvent=new CustomEvent("entityChanged",{detail:{changed:!0}}),this.enableVertexSnap=this.enableVertexSnap.bind(this),this.disableVertexSnap=this.disableVertexSnap.bind(this),this.enableEdgeSnap=this.enableEdgeSnap.bind(this),this.disableEdgeSnap=this.disableEdgeSnap.bind(this),this.setGravity=this.setGravity.bind(this)}enableEdgeSnap(){this.edgeSnap=!0}disableEdgeSnap(){this.edgeSnap=!1}enableVertexSnap(){this.vertexSnap=!0}disableVertexSnap(){this.vertexSnap=!1}setGravity(t){this.gravity=t}addChild(t){super.addChild(t),window.dispatchEvent(this.entitySelectedEvent)}setSelectedEntityName(t){window.dispatchEvent(this.entitySelectedEvent),this.selectedEntityName=t}getSelectedEntity(){return this.children.find((t=>t.name==this.selectedEntityName))}getEntityChangeEvent(){this.entitySelectedEvent}}const r={design:"design",play:"play",paused:"Paused"};Object.freeze(r);class o{constructor(t){this.name=t,this.TextureCache=PIXI.utils.TextureCache,this.scenes=[],this.currentSceneIndex=0,this.mode=r.design,this.addBackground=this.addBackground.bind(this),this.play=this.play.bind(this),this.init=this.init.bind(this),this.stop=this.stop.bind(this),this.update=this.update.bind(this)}init(t,e){let i=new n("gameScene",t,e);i.mode=this.mode,i.visible=!0,this.scenes.push(i)}getSceneAtIndex(t){if("number"==typeof t&&t<this.scenes.length)return this.scenes[t]}getCurrentScene(){return this.scenes[this.currentSceneIndex]}setGameMode(t){this.mode=r[t],this.scenes[this.currentSceneIndex].mode=this.mode}addBackground(t){if(null!=t){let e=new i(t);this.scenes[this.currentSceneIndex].addChild(e)}}play(t){this.update(t)}stop(){}update(t){this.scenes[this.currentSceneIndex].children.forEach((e=>{e instanceof s&&(e.transformX(1),function(t,e){!1===t.onSurface()&&t.y+t.width/2<t.parent._height&&(t.y=t.y+.5*t.parent.gravity*Math.pow(e,2))}(e,t))}))}}const a={MOUSE:{UP:"mouseup",DOWN:"mousedown",CLICK:"click",DOUBLECLICK:"dblclick"},KEYBOARD:{KEYDOWN:"keydown",KEYPRESS:"keypress",KEYUP:"keyup"},FORM:{FOCUS:"focus",BLUR:"blur",CHANGE:"change",SUBMIT:"submit"},WINDOW:{SCROLL:"scroll",RESIZE:"resize",HASHCHANGE:"hashchange",LOAD:"load",UNLOAD:"unload"}};Object.freeze(a);const d=a;class h{constructor(){}set title(t){if("string"!=typeof t)throw TypeError("Provided Title is not of type String");this._title=t}get title(){return this._title}set bodyText(t){if("string"!=typeof t)throw TypeError("Provided Body Text is not of type String");this._bodyText=t}set buttons(t){Array.isArray(t)&&t.forEach((t=>{if(!(t instanceof c))throw TypeError("Provided Array should have elements of type Button")})),this._buttons=t}set image(t){if("string"!=typeof t)throw TypeError("Provided Image is not of type String");this._image=t}set header(t){if("string"!=typeof t)throw TypeError("Provided Header Text is not of type String");this._header=t}set center(t){if("boolean"!=typeof t)throw TypeError("Provided Center is not of type Boolean");this._center=t}set colour(t){if(!(t instanceof l))throw TypeError("Provided Colour is not of type Colour");this._colour=t}set whiteText(t){if("boolean"!=typeof t)throw TypeError("Provided White Text Value is not of type Boolean");this._whiteText=t}get bodyText(){return this._bodyText}get buttons(){return this._buttons}get image(){return this._image}get header(){return this._header}get center(){return this._center}get colour(){return this._colour}get whiteText(){return this._whiteText}}class c{constructor(t,e,i,s,n){this.title=t,this.id=e,this.action=i,this.colour=s,this.fontSize=n}}class l{constructor(t,e,i,s){if("number"!=typeof t||"number"!=typeof e||"number"!=typeof i||"number"!=typeof s)throw new"Provided Colour is not of type Number";this.red=t,this.green=e,this.blue=i,this.alpha=s}colourToString(){return`rgba(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`}}var u={Primary:new l(2,117,216,1),Secodnary:new l(92,184,92,1),Dark:new l(41,43,44,1),Danger:new l(217,83,79,1),Light:new l(247,247,247,1)},g={Small:"10px",Smaller:"12px",Medium:"16px",Larger:"20px",Large:"24px"};Object.freeze(u),Object.freeze(g);const m={designing:"Designing",playing:"Playing",paused:"Paused"};Object.freeze(m),(new class{constructor(){this.loader=new PIXI.Loader,this.stage=new PIXI.Container,this.currentGameIndex=0,this.games=[],this._entityContainerId="entities",this._entities=document.getElementById(this._entityContainerId),this._posForm=document.getElementById("positionForm"),this._rotForm=document.getElementById("rotationForm"),this._scaleForm=document.getElementById("scaleForm"),this._filtEntForm=document.getElementById("filterEntitiesForm"),this.currentMode=m.designing,this.init=this.init.bind(this),this.loadTexturesFromLocal=this.loadTexturesFromLocal.bind(this),this.createGame=this.createGame.bind(this),this.loadDefaultAssets=this.loadDefaultAssets.bind(this),this.createGameEntity=this.createGameEntity.bind(this),this.addTestObjects=this.addTestObjects.bind(this),this.render=this.render.bind(this),this.playGame=this.playGame.bind(this),this.stopGame=this.stopGame.bind(this)}addTestObjects(){const t=new i(PIXI.utils.TextureCache.redTile,"red");t.x=20,t.y=20,this.games[this.currentGameIndex].scenes[0].addChild(t);const e=new i(PIXI.utils.TextureCache.blackTile,"black");e.x=20,e.y=20,this.games[this.currentGameIndex].scenes[0].addChild(e);const s=new i(PIXI.utils.TextureCache.yellowTile,"yellow");s.x=20,s.y=20,this.games[this.currentGameIndex].scenes[0].addChild(s);const n=new i(PIXI.utils.TextureCache.brownTile,"brown");n.x=20,n.y=20,this.games[this.currentGameIndex].scenes[0].addChild(n);const r=new i(PIXI.utils.TextureCache.greenTile,"green");r.x=20,r.y=20,this.games[this.currentGameIndex].scenes[0].addChild(r)}filterEntities(){document.getElementById("entities"),this._filtEntForm.addEventListener(d.FORM.SUBMIT,(t=>{t.preventDefault();const e=new FormData(t.target),i={};for(let t of e.entries())i[t[0]]=t[1];console.log(`Filtering By: ${i.type}`)}))}initializeEntitySettings(){const t=this.games[this.currentGameIndex].getCurrentScene();window.addEventListener("entityChanged",(e=>{if(t){const e=t.children.findIndex((e=>{if(e.name===t.selectedEntityName)return!0}));e>-1&&(document.getElementById("xPosition").value=t.children[e].transform.position.x.toFixed(2),document.getElementById("yPosition").value=t.children[e].transform.position.y.toFixed(2),document.getElementById("xScale").value=t.children[e].transform.scale.x.toFixed(2),document.getElementById("yScale").value=t.children[e].transform.scale.y.toFixed(2),document.getElementById("rotationDeg").value=t.children[e].transform.rotation.toFixed(2))}})),this._posForm.addEventListener(d.FORM.SUBMIT,(e=>{e.preventDefault();const i=new FormData(e.target),s={};for(let t of i.entries())s[t[0]]=t[1];if(i||alert("Invalid form submitted"),t){const e=t.children.findIndex((e=>{if(e.name===t.selectedEntityName)return!0}));e>-1&&t.children[e].transformEntity(parseFloat(s.x),parseFloat(s.y))}})),this._rotForm.addEventListener(d.FORM.SUBMIT,(e=>{e.preventDefault();const i=new FormData(e.target),s={};for(let t of i.entries())s[t[0]]=t[1];if(i||alert("Invalid form submitted"),t){const e=t.children.findIndex((e=>{if(e.name===t.selectedEntityName)return!0}));e>-1&&t.children[e].rotateEntity(this.degrees_to_radians(parseFloat(s.degrees)))}})),this._scaleForm.addEventListener(d.FORM.SUBMIT,(e=>{e.preventDefault();const i=new FormData(e.target),s={};for(let t of i.entries())s[t[0]]=t[1];if(i||alert("Invalid form submitted"),t){const e=t.children.findIndex((e=>{if(e.name===t.selectedEntityName)return!0}));e>-1&&t.children[e].scaleEntity(parseFloat(s.x),parseFloat(s.y))}}))}degrees_to_radians(t){return t*(Math.PI/180)}init(){const t=PIXI.autoDetectRenderer({antalias:!0,autoDensity:!0,resolution:window.devicePixelRatio||1,width:900,height:600});this.renderer=t,document.getElementById("engine-view").appendChild(t.view),document.querySelector("#upload-button").addEventListener("change",this.loadTexturesFromLocal,!1),document.querySelector("#create-sprite-button").addEventListener("click",this.createGameEntity,!1),document.querySelector("#play-button").addEventListener("click",this.playGame,!1),document.querySelector("#stop-button").addEventListener("click",this.stopGame,!1),this.loader.baseUrl="/public/assets/",this.loadDefaultAssets(),this.createGame("Test Game"),this.games[this.currentGameIndex].scenes.forEach((t=>{this.stage.addChild(t)})),this.initializeEntitySettings(),this.filterEntities(),PIXI.Ticker.shared.add(this.render)}render(t){this.renderer.clear(),"play"===this.games[this.currentGameIndex].mode&&this.games[this.currentGameIndex].play(t),this.renderer.render(this.stage)}loadDefaultAssets(){this.loader.add("blueTile","images/blueTile.png").add("brownTile","images/brownTile.png").add("blackTile","images/blackTile.png").add("greenTile","images/greenTile.png").add("yellowTile","images/yellowTile.png").add("redTile","images/redTile.png").add("whiteTile","images/whiteTile.png").add("orangeTile","images/orangeTile.png").add("background","images/background.jpg"),this.loadEntityToWorkspace("blueTile","images/blueTile.png"),this.loader.onComplete.add(this.addTestObjects),this.loader.load()}loadEntityToWorkspace(t,e){const i="/public/assets/"+e,s=new class{constructor(){var t=document.head,e=document.createElement("link");t.innerHTML.indexOf("dynamic-card.css")<=-1&&(e.type="text/css",e.rel="stylesheet",e.href="/public/scripts/view-components/cards/styling/dynamic-card.css",t.appendChild(e))}createInlineCard(t){if(!(t instanceof h))throw new TypeError("Provided Card is not of type Card");const e=document.createElement("section");if(e.id="inline-card-object",e.classList.add("dynamic-inline-card"),t.colour&&(e.style.backgroundColor=t.colour.colourToString()),t.image){const i=document.createElement("img");i.id="inline-card-image",i.src=t.image,e.appendChild(i)}const i=document.createElement("div");if(i.id="inline-card-content",i.classList.add("dynamic-inline-card-content"),t.title){const e=document.createElement("a");e.id="card-body-title",e.innerHTML=t.title,i.appendChild(e)}return t.buttons&&Array.isArray(t.buttons)&&t.buttons.forEach((t=>{const e=document.createElement("button");e.onclick=t.action,e.innerHTML=t.title,e.id=t.id,e.classList.add("dynamic-card-button-sm"),e.style.backgroundColor=t.colour.colourToString(),e.style.fontSize=t.fontSize,e.style.marginLeft="auto",i.appendChild(e)})),e.appendChild(i),e}createGenericCard(t){if(!(t instanceof h))throw new TypeError("Provided Card is not of type Card");const e=document.createElement("section");if(e.id="card-object",e.classList.add("dynamic-card"),t.colour&&(e.style.backgroundColor=t.colour.colourToString()),t.image){const i=document.createElement("img");i.classList.add("dynamic-card-image"),i.id="card-image",i.src=t.image,e.appendChild(i)}if(t.header){const i=document.createElement("div");i.id="card-body-header",i.classList.add("dynamic-card-header"),i.innerHTML=t.header,t.center&&(i.style.textAlign="center"),t.whiteText&&(i.style.color=u.Light.colourToString()),e.appendChild(i)}const i=document.createElement("div");if(i.classList.add("dynamic-card-container"),t.title){const e=document.createElement("h3");e.id="card-body-title",e.innerHTML=t.title,e.classList.add("dynamic-card-title"),t.center&&(e.style.textAlign="center"),t.whiteText&&(e.style.color=u.Light.colourToString()),i.appendChild(e)}if(t.bodyText||t.buttons&&Array.isArray(t.buttons)){if(t.bodyText){const e=document.createElement("p");e.id="card-body-text",e.innerText=t.bodyText,e.classList.add("dynamic-card-text"),t.center&&(e.style.textAlign="center"),t.whiteText&&(e.style.color=u.Light.colourToString()),i.appendChild(e)}t.buttons&&Array.isArray(t.buttons)&&t.buttons.length>0&&i.appendChild(this.createButtonContainer(t.buttons,t.center))}if(e.appendChild(i),t.footer){const i=document.createElement("div");i.id="card-body-footer",i.classList.add("dynamic-card-footer"),i.innerHTML=t.footer,t.center&&(i.style.textAlign="center"),t.whiteText&&(i.style.color=u.Light.colourToString()),e.appendChild(i)}return e}createButtonContainer(t,e=!1){if(!Array.isArray(t))throw"Provided Buttons object is not of type Array";const i=document.createElement("div");return i.id="card-body-buttons-container",i.classList.add("dynamic-card-button-container"),e&&(i.style.justifyContent="center"),t.forEach((t=>{const e=document.createElement("button");e.onclick=t.action,e.innerHTML=t.title,e.id=t.id,e.classList.add("dynamic-card-button"),e.style.backgroundColor=t.colour.colourToString(),e.style.fontSize=t.fontSize,i.appendChild(e)})),i}},n=new h;n.title=t,n.image=i,n.colour=u.Light;var r=new Array;const o=new c;o.title="Add",o.id=t,o.colour=u.Primary,o.fontSize=g.Smaller,o.action=t=>{t.preventDefault();const e=t.target.id;this.createGameEntity(PIXI.utils.TextureCache[e])},r.push(o),n.buttons=r;let a=s.createInlineCard(n);this._entities.appendChild(a)}loadTexturesFromLocal(t){let e=t.target,i=e.files;for(let t=0;t<i.length;t++){let i=new FileReader;i.onload=()=>{const s=new Image;s.src=i.result;let n=new PIXI.BaseTexture(s.src);PIXI.Texture.addToCache(n,e.files[t].name)},i.readAsDataURL(e.files[t])}}createGame(t){let e=new o(t);e.init(this.renderer.view.width,this.renderer.view.height),this.games.push(e)}deleteGame(t){}saveGame(){}createGameEntity(t=PIXI.utils.TextureCache.blueTile){const e=this.games[this.currentGameIndex].scenes[0].children.length,i=new s(t,"untitled"+e);i.x=this.renderer.screen.width/2,i.y=this.renderer.screen.height/2,this.games[this.currentGameIndex].getCurrentScene().setSelectedEntityName(i.name),this.games[this.currentGameIndex].scenes[0].addChild(i)}playGame(){this.games[this.currentGameIndex].setGameMode("play")}stopGame(){this.games[this.currentGameIndex].setGameMode("design")}}).init()})();